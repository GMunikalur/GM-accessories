<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G&M accessories</title>
    <!-- Tailwind CSS-ის ჩართვა CDN-დან -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts-ის Inter შრიფტის ჩართვა -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome-ის ჩართვა ხატულებისთვის (სოციალური მედია) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Inter შრიფტის გამოყენება მთელ გვერდზე */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* მორგებული სტილები ღილაკებისთვის */
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-full shadow-md transition duration-300 ease-in-out;
        }
        .btn-secondary {
            @apply bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded-full shadow-md transition duration-300 ease-in-out;
        }
        /* loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6; /* Tailwind blue-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Custom Message Box -->
    <div id="messageBox" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl text-center max-w-sm mx-auto">
            <p id="messageText" class="text-gray-800 text-lg mb-4"></p>
            <button id="messageBoxCloseBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300">
                დახურვა
            </button>
        </div>
    </div>

    <!-- Header Section -->
    <header class="bg-white shadow-md py-6 px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-5xl font-extrabold text-blue-700 mb-2">G&M accessories</h1>
            <p class="text-lg text-gray-600">
                ონლაინ საიტი, სადაც შეძლებთ ჩვენი პროდუქტის ნახვას, მათ ფასებს და ჩვენთან მარტივი კომუნიკაციის გზას.
            </p>
        </div>
    </header>

    <!-- Product Upload Section -->
    <section class="py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-xl p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">პროდუქტის დამატება</h2>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/2">
                    <label for="productImage" class="block text-gray-700 text-sm font-bold mb-2">
                        აირჩიეთ ფოტო:
                    </label>
                    <input type="file" id="productImage" accept="image/*" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                    
                    <label for="productDescription" class="block text-gray-700 text-sm font-bold mb-2">
                        პროდუქტის აღწერა:
                    </label>
                    <textarea id="productDescription" rows="4" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" placeholder="ჩაწერეთ პროდუქტის მოკლე აღწერა..."></textarea>
                    
                    <!-- Gemini API ღილაკი აღწერის გასაუმჯობესებლად -->
                    <button id="enhanceDescriptionBtn" class="btn-secondary w-full flex items-center justify-center mb-4">
                        <span class="mr-2">✨</span> <span id="enhanceBtnText">აღწერის გაუმჯობესება</span>
                        <div id="enhanceBtnSpinner" class="spinner ml-2 hidden"></div>
                    </button>

                    <button id="addProductBtn" class="btn-primary w-full flex items-center justify-center">
                        <span id="addBtnText">პროდუქტის დამატება</span>
                        <div id="addBtnSpinner" class="spinner ml-2 hidden"></div>
                    </button>
                    <p id="uploadMessage" class="text-sm text-red-500 mt-2 hidden">
                        *გთხოვთ გაითვალისწინოთ: ატვირთული ფოტოები და აღწერები არ ინახება. გვერდის განახლებისას ისინი გაქრება.
                    </p>
                </div>
                <div class="md:w-1/2 flex items-center justify-center bg-gray-50 rounded-md p-4">
                    <img id="imagePreview" src="https://placehold.co/300x200/e2e8f0/64748b?text=ფოტოს+წინასწარი+ნახვა" alt="ფოტოს წინასწარი ნახვა" class="max-w-full h-auto rounded-md shadow-inner">
                </div>
            </div>
        </div>
    </section>

    <!-- Products Display Section -->
    <section class="py-12 px-4 sm:px-6 lg:px-8 bg-gray-50">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">ჩვენი პროდუქტები</h2>
            <div id="productsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- პროდუქტები აქ დაემატება JavaScript-ის საშუალებით -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <img src="https://placehold.co/400x300/e2e8f0/64748b?text=ნიმუში+1" alt="ნიმუში პროდუქტი 1" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold mb-2">ნიმუში პროდუქტი 1</h3>
                        <p class="text-gray-600 text-sm mb-3">ეს არის ნიმუში პროდუქტის აღწერა. აქ შეგიძლიათ განათავსოთ დეტალები პროდუქტის შესახებ.</p>
                        <p class="text-lg font-bold text-blue-600">ფასი: 25.00 GEL</p>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <img src="https://placehold.co/400x300/e2e8f0/64748b?text=ნიმუში+2" alt="ნიმუში პროდუქტი 2" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-xl font-semibold mb-2">ნიმუში პროდუქტი 2</h3>
                        <p class="text-gray-600 text-sm mb-3">კიდევ ერთი ნიმუში პროდუქტი, რომელიც აჩვენებს, თუ როგორ შეიძლება გამოიყურებოდეს თქვენი პროდუქტები.</p>
                        <p class="text-lg font-bold text-blue-600">ფასი: 40.00 GEL</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-xl p-8 text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">დაგვიკავშირდით</h2>
            <p class="text-gray-600 mb-8">
                შეგიძლიათ დაგვიკავშირდეთ შემდეგი სოციალური მედიის პლატფორმების საშუალებით:
            </p>
            <div class="flex justify-center space-x-6">
                <a href="https://www.instagram.com/" target="_blank" class="text-gray-600 hover:text-pink-600 transition duration-300">
                    <i class="fab fa-instagram text-4xl"></i>
                    <span class="block text-sm mt-1">Instagram</span>
                </a>
                <a href="https://www.tiktok.com/" target="_blank" class="text-gray-600 hover:text-black transition duration-300">
                    <i class="fab fa-tiktok text-4xl"></i>
                    <span class="block text-sm mt-1">TikTok</span>
                </a>
                <a href="https://www.facebook.com/" target="_blank" class="text-gray-600 hover:text-blue-700 transition duration-300">
                    <i class="fab fa-facebook-f text-4xl"></i>
                    <span class="block text-sm mt-1">Facebook</span>
                </a>
                <a href="https://wa.me/YOURPHONENUMBER" target="_blank" class="text-gray-600 hover:text-green-500 transition duration-300">
                    <i class="fab fa-whatsapp text-4xl"></i>
                    <span class="block text-sm mt-1">WhatsApp</span>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white py-6 px-4 sm:px-6 lg:px-8 text-center">
        <div class="max-w-4xl mx-auto">
            <p>&copy; 2025 G&M accessories. ყველა უფლება დაცულია.</p>
        </div>
    </footer>

    <script>
        const productImageInput = document.getElementById('productImage');
        const productDescriptionInput = document.getElementById('productDescription');
        const addProductBtn = document.getElementById('addProductBtn');
        const productsContainer = document.getElementById('productsContainer');
        const imagePreview = document.getElementById('imagePreview');
        const uploadMessage = document.getElementById('uploadMessage');
        const addBtnText = document.getElementById('addBtnText');
        const addBtnSpinner = document.getElementById('addBtnSpinner');

        const enhanceDescriptionBtn = document.getElementById('enhanceDescriptionBtn');
        const enhanceBtnText = document.getElementById('enhanceBtnText');
        const enhanceBtnSpinner = document.getElementById('enhanceBtnSpinner');

        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageBoxCloseBtn = document.getElementById('messageBoxCloseBtn');

        // ფუნქცია მორგებული შეტყობინების საჩვენებლად
        function showMessage(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        // შეტყობინების დახურვის ღილაკი
        messageBoxCloseBtn.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        // Gemini API-ის კონფიგურაცია
        const apiKey = ""; // API გასაღები ავტომატურად მოწოდებული იქნება Canvas-ის მიერ
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        // ფუნქცია Gemini API-ზე ზარის განსახორციელებლად ექსპონენციალური უკუგანვითარებით
        async function callGeminiAPI(prompt, retries = 3, delay = 1000) {
            try {
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    // თუ პასუხი არ არის წარმატებული, სცადეთ ხელახლა
                    if (response.status === 429 && retries > 0) { // 429 Too Many Requests
                        console.warn(`API ლიმიტი გადაჭარბებულია, ხელახლა ცდა ${delay / 1000} წამში...`);
                        await new Promise(res => setTimeout(res, delay));
                        return callGeminiAPI(prompt, retries - 1, delay * 2); // ექსპონენციალური უკუგანვითარება
                    }
                    throw new Error(`HTTP შეცდომა! სტატუსი: ${response.status}`);
                }

                const result = await response.json();
                
                // შეამოწმეთ, არსებობს თუ არა მოსალოდნელი სტრუქტურა
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("Gemini API-დან არასწორი პასუხის სტრუქტურა.");
                }

            } catch (error) {
                console.error("შეცდომა Gemini API-ზე ზარის განხორციელებისას:", error);
                return `შეცდომა: ${error.message}. გთხოვთ, სცადოთ მოგვიანებით.`;
            }
        }

        // ფოტოს წინასწარი ნახვის ფუნქცია
        productImageInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                imagePreview.src = "https://placehold.co/300x200/e2e8f0/64748b?text=ფოტოს+წინასწარი+ნახვა";
            }
        });

        // პროდუქტის დამატების ფუნქცია
        addProductBtn.addEventListener('click', function() {
            const imageFile = productImageInput.files[0];
            const description = productDescriptionInput.value.trim();

            if (!imageFile || !description) {
                showMessage('გთხოვთ, აირჩიოთ ფოტო და შეიყვანოთ აღწერა.');
                return;
            }

            // ჩატვირთვის ინდიკატორის ჩვენება
            addBtnText.classList.add('hidden');
            addBtnSpinner.classList.remove('hidden');
            addProductBtn.disabled = true; // ღილაკის გათიშვა

            // იმიტირებული დაყოვნება API ზარისთვის (რეალურ აპლიკაციაში აქ იქნებოდა სერვერზე ატვირთვა)
            setTimeout(() => {
                const imageUrl = URL.createObjectURL(imageFile);

                const productCard = `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <img src="${imageUrl}" alt="${description}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h3 class="text-xl font-semibold mb-2">ახალი პროდუქტი</h3>
                            <p class="text-gray-600 text-sm mb-3">${description}</p>
                            <p class="text-lg font-bold text-blue-600">ფასი: (დაამატეთ ფასი)</p>
                        </div>
                    </div>
                `;
                productsContainer.insertAdjacentHTML('afterbegin', productCard); // დაამატეთ ზემოთ

                // ველების გასუფთავება
                productImageInput.value = '';
                productDescriptionInput.value = '';
                imagePreview.src = "https://placehold.co/300x200/e2e8f0/64748b?text=ფოტოს+წინასწარი+ნახვა";

                // ჩატვირთვის ინდიკატორის დამალვა
                addBtnText.classList.remove('hidden');
                addBtnSpinner.classList.add('hidden');
                addProductBtn.disabled = false; // ღილაკის გააქტიურება
                uploadMessage.classList.remove('hidden'); // შეტყობინების ჩვენება
            }, 1000); // 1 წამიანი დაყოვნება იმიტაციისთვის
        });

        // აღწერის გაუმჯობესების ფუნქცია Gemini API-ის გამოყენებით
        enhanceDescriptionBtn.addEventListener('click', async function() {
            const currentDescription = productDescriptionInput.value.trim();

            if (!currentDescription) {
                showMessage('გთხოვთ, შეიყვანოთ ტექსტი აღწერის ველში, რომ გააუმჯობესოთ.');
                return;
            }

            // ჩატვირთვის ინდიკატორის ჩვენება
            enhanceBtnText.classList.add('hidden');
            enhanceBtnSpinner.classList.remove('hidden');
            enhanceDescriptionBtn.disabled = true; // ღილაკის გათიშვა

            const prompt = `გააუმჯობესე და გააფართოვე შემდეგი პროდუქტის აღწერა ქართულად, გახადე ის უფრო მიმზიდველი და დეტალური: "${currentDescription}"`;
            const enhancedText = await callGeminiAPI(prompt);

            productDescriptionInput.value = enhancedText;

            // ჩატვირთვის ინდიკატორის დამალვა
            enhanceBtnText.classList.remove('hidden');
            enhanceBtnSpinner.classList.add('hidden');
            enhanceDescriptionBtn.disabled = false; // ღილაკის გააქტიურება
        });
    </script>
</body>
</html>
